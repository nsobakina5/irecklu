jQuery(function(y){y.fn.yith_bundle_form=function(){y(this).each(function(){var t=y(this),r=t.data("product-id"),c=(t.data("per-item-pricing"),t.data("ajax-update-price")),e=t.find(".yith-wcpb-product-bundled-items .price"),i=t.closest(yith_wcpb_params.price_handler_parent).find(yith_wcpb_params.price_handler)||t.closest(yith_wcpb_params.price_handler_parent_alt).find(yith_wcpb_params.price_handler_alt),l=1==yith_wcpb_params.price_handler_only_first?i.not(e).first():i.not(e),a=t.closest("form").find("button[type=submit]"),n=t.closest(".product").find(".add-request-quote-button"),p=t.find(".bundled_item_cart_content"),s=t.find("input.yith-wcpb-bundled-quantity"),u=t.find(".yith-wcpb-bundled-optional"),h=t.find(".variation_id"),f=t.find("input[name=yith_wcpb_wpml_client_currency]"),m=null,g={message:null,overlayCSS:{background:"#fff",opacity:.6},ignoreIfBlocked:!0},d=function(t){y(this).is(".disabled")&&(t.preventDefault(),y(this).is(".yith-wcpb-out-of-stock-item-selected")?window.alert(yith_wcpb_params.i18n.out_of_stock_item_selected):y(this).is(".yith-wcpb-variation-selection-needed")&&window.alert(yith_wcpb_params.i18n.variation_selection_needed))};a.on("click",d),n.on("click",d),t.on("yith_wcpb_update_price",function(){var d,o,_,t,e;_=o=d=!1,e=[t="disabled","yith-wcpb-variation-selection-needed","yith-wcpb-out-of-stock-item-selected"].join(" "),p.each(function(){var t=y(this),e=t.find(".yith-wcpb-bundled-optional"),i=t.find(".yith-wcpb-bundled-quantity"),a=t.find("select.yith-wcpb-select-for-variables"),n=e.length,r=n&&e.is(":checked"),c=i.length&&0===parseInt(i.val());n&&!r||c?n&&(t.find(".quantity input.qty").removeAttr("max"),t.find(".single_variation_wrap").slideUp("fast"),t.find(".variations").slideUp("fast")):(a.each(function(){y(this).val()||(o=d=!0)}),t.find(".variations").slideDown("fast"),t.find(".single_variation_wrap").slideDown("fast"),t.find(".out-of-stock").length&&(_=d=!0))}),o&&(t+=" yith-wcpb-variation-selection-needed"),_&&(t+=" yith-wcpb-out-of-stock-item-selected"),d?a.addClass(t):a.removeClass(e),n.length&&(d?n.addClass(t):n.removeClass(e)),function(){if(m&&m.abort(),1==c){l.block(g);var t=[],e=[],i=[];s.each(function(){t[y(this).data("item-id")-1]=y(this).val()}),u.each(function(){e[y(this).data("item-id")-1]=y(this).is(":checked")?1:0}),h.each(function(){i[y(this).data("item-id")-1]=y(this).val()});var a=0<f.length?f.val():"",n={bundle_id:r,array_qty:t,array_opt:e,array_var:i,yith_wcpb_wpml_client_currency:a,action:"yith_wcpb_get_bundle_total_price"};m=y.ajax({type:"POST",data:n,url:ajax_obj.ajaxurl,success:function(t){var e=l.find("ins .amount");e.length<1&&(e=l.find(".amount")),e.length<1&&(e=l),(e=e.first()).html(t.price_html),l.html(t.price_html),y(document).trigger("yith_wcpb_ajax_update_price_request",t),l.unblock()}})}}()}),"yes"===yith_wcpb_params.update_price_on_load&&t.trigger("yith_wcpb_update_price"),s.on("change",function(){y(this).parents(".bundled_item_cart_content").length||t.trigger("yith_wcpb_update_price")}),u.on("click",function(){y(this).parents(".bundled_item_cart_content").length||t.trigger("yith_wcpb_update_price")}),p.on("change",function(){t.trigger("yith_wcpb_update_price")}),p.on("found_variation",function(t,e){var i=y(this).closest(".product"),a=i.find(".yith-wcpb-product-bundled-item-image .price").first(),n=a.find("ins"),r=a.find("del"),c=i.find(".yith-wcpb-product-bundled-item-image-wrapper img").first(),d=i.data("min-quantity"),o=i.data("max-quantity"),_=i.find(".yith-wcpb-bundled-quantity");_.length&&(_.attr("min",d),_.attr("max",o)),"undefined"!=typeof e.image&&("undefined"!=typeof e.image.srcset&&e.image.srcset?c.attr("srcset",e.image.srcset):"undefined"!=typeof e.image.thumb_src&&e.image.thumb_src&&(c.removeAttr("srcset"),c.attr("src",e.image.thumb_src)),"undefined"!=typeof e.image.full_src&&"undefined"!=typeof e.image.full_src_h&&"undefined"!=typeof e.image.full_src_w&&(c.attr("data-large_image",e.image.full_src),c.attr("data-large_image_width",e.image.full_src_w),c.attr("data-large_image_height",e.image.full_src_h))),n.html(e.price_html.replace("price","amount")),r.html(e.display_regular_price_html)}).on("reset_data",function(){var t=y(this).closest(".product"),e=t.find(".yith-wcpb-product-bundled-item-image .price").first(),i=e.find("ins"),a=i.data("default-ins"),n=e.find("del"),r=n.data("default-ins"),c=t.find(".yith-wcpb-product-bundled-item-image-wrapper img").first(),d=c.attr("src");void 0!==d&&0<d.length&&c.attr("srcset",d),i.html(a),n.html(r)}),p.trigger("check_variations"),p.trigger("update_variation_values")})},y(document).on("yith_wcpb_add_to_cart_init",function(){y(".yith-wcpb-bundle-form").yith_bundle_form()}).trigger("yith_wcpb_add_to_cart_init"),y(document).on("qv_loader_stop",function(){y(document).trigger("yith_wcpb_add_to_cart_init")}),y(document).on("mfpOpen",function(){y(".variations_form").each(function(){y(this).wc_variation_form()}),y(document).trigger("yith_wcpb_add_to_cart_init")});var r={enabled:"undefined"!=typeof PhotoSwipe&&"undefined"!=typeof PhotoSwipeUI_Default&&"undefined"!=typeof wc_single_product_params&&"yes"===yith_wcpb_params.photoswipe_enabled,init:function(){y(document).on("click",".yith-wcpb-product-bundled-item-image-wrapper .woocommerce-product-gallery__image a",this.openPhotoswipe),this.indexGallery()},getImages:function(){return y(".yith-wcpb-product-bundled-item-image-wrapper .woocommerce-product-gallery__image")},indexGallery:function(){var t=this.getImages(),e=0;t.each(function(){y(this).data("bundled-image-index",e),e++})},getGalleryItems:function(){var t=this.getImages(),n=[];return 0<t.length&&t.each(function(t,e){var i=y(e).find("img");if(i.length){var a={src:i.attr("data-large_image"),w:i.attr("data-large_image_width"),h:i.attr("data-large_image_height"),title:i.attr("data-caption")?i.attr("data-caption"):i.attr("title")};n.push(a)}}),n},openPhotoswipe:function(t){if(t.preventDefault(),r.enabled){var e=y(".pswp")[0],i=r.getGalleryItems(),a=y(t.target).closest(".woocommerce-product-gallery__image"),n=y.extend({index:y(a).data("bundled-image-index")},wc_single_product_params.photoswipe_options);new PhotoSwipe(e,PhotoSwipeUI_Default,i,n).init()}}};r.init()});